---
- hosts: localhost
  connection: local
  tasks:

    - name: "create directory path to store the configuration files"
      file:
        path: "/opt/{{ project_name }}"
        state: directory
        mode: 0755

    - name: debug
      debug: 
        var: environment_variables

    - name: Set environment variables
      lineinfile:
        path: /opt/{{ project_name }}/.env
        line: "{{ item.key }}={{ item.value }}"
        create: yes
      with_dict: "{{ environment_variables }}"

    - name: Add HOST_PUBLIC_IP and additional environment variables
      lineinfile:
        path: /opt/{{ project_name }}/.env
        line: "{{ item.key }}={{ item.value }}"
        create: yes
      with_items:
         - { key: "TRAEFIK_VERSION", value: "{{ traefik_version | replace('\'','') }}" }
         - { key: "OWNCLOUD_VERSION", value: "{{ owncloud_version | replace('\'','') }}" }
         - { key: "OWNCLOUD_HOSTNAME", value: "{{ owncloud_hostname }}" }
         - { key: "NAGIOS_HOSTNAME", value: "{{ nagios_hostname }}" }
         - { key: "DUPLICATI_HOSTNAME", value: "{{ duplicati_hostname }}" }
         - { key: "HOST_PUBLIC_IP" , value: "{{ IM_NODE_PUBLIC_IP }}" }

